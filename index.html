<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Î¤Î±Î¾Î¯Î´Î¹ Î ÏÎ­Î²ÎµÎ¶Î± 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Î•Î¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ QR -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1Rn23ZZf7ZgEycboRfrACTShGLeJIiNU&libraries=places"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f7fafc;
      color: #222;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0099cc;
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 1.8em;
    }
    main {
      max-width: 960px;
      margin: 20px auto;
      padding: 20px;
    }
    label {
      font-weight: bold;
    }
    select, input, textarea, button {
      font-size: 1em;
      margin: 6px 0;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    select, input[type="file"] {
      width: 100%;
    }
    .tab-section { display: none; }
    .tab-section.active { display: block; }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0001;
      font-size: 1em;
    }
    th, td {
      padding: 10px 8px;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #e0f4ff;
      color: #222;
      font-weight: 700;
    }
    .importExportBar {
      margin: 14px 0;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .importExportBar input[type=file] { display: none; }
    .filter-bar { margin-bottom: 12px; display: flex; gap: 8px;}
    .filter-btn {
      background: #fff;
      color: #0099cc;
      border: 1px solid #0099cc;
      border-radius: 5px;
      padding: 6px 14px;
      font-size: 1em;
      cursor: pointer;
    }
    .filter-btn.active { background: #0099cc; color: #fff;}
    .place-list { list-style: none; padding: 0; }
    .place-item { background: #fff; margin-bottom: 12px; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 12px; position: relative;}
    .place-title { font-weight: bold; font-size: 1.1em; margin-bottom: 4px; }
    .gallery { display: flex; gap: 7px; flex-wrap: wrap; margin-top: 6px; }
    .gallery img { width: 78px; height: 78px; object-fit: cover; border-radius: 6px; border: 1.5px solid #e9f2fb; }
    .edit-form { margin-top: 10px; background: #e0f4ff; border-radius: 7px; padding: 10px; }
    .map-btn { background: #eee; color: #0099cc; border: none; border-radius: 4px; padding: 5px 13px; font-size: 0.95em; margin-left: 4px; cursor: pointer;}
    .extra-expense-list { list-style: none; padding: 0; }
    .extra-expense-item { background: #fff; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 10px 12px; display: flex; align-items: center; gap: 10px;}
    .extra-expense-total { font-weight: bold; font-size: 1.1em; color: #0099cc; margin-top: 10px; }
    #selectedDaysSummary { margin-bottom: 18px; }
    #qrCodeContainer { margin: 24px 0 16px 0; }
  </style>
</head>
<body>
  <header>
    Î¤Î±Î¾Î¯Î´Î¹ Î ÏÎ­Î²ÎµÎ¶Î± 2025
  </header>
  <main>
    <label for="tabSelect">Î•Ï€Î¯Î»ÎµÎ¾Îµ ÎºÎ±ÏÏ„Î­Î»Î±:</label>
    <select id="tabSelect">
      <option value="programma">ğŸ“… Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î±</option>
      <option value="exoda">ğŸ’¶ ÎˆÎ¾Î¿Î´Î±</option>
      <option value="paralies">ğŸ–ï¸ Î Î±ÏÎ±Î»Î¯ÎµÏ‚ & Î¤Î± Î¼Î­ÏÎ· Î¼Î¿Ï…</option>
      <option value="epipleon_exoda">â• Î•Ï€Î¹Ï€Î»Î­Î¿Î½ Î­Î¾Î¿Î´Î±</option>
      <option value="qrshare">ğŸ“· QR Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®/Î›Î®ÏˆÎ· Î ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚</option>
      <option value="map">ğŸ—ºï¸ Î§Î¬ÏÏ„Î·Ï‚</option>
    </select>

    <!-- Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± -->
    <section id="programma" class="tab-section active">
      <h2>Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î—Î¼ÎµÏÏÎ½ Î”Î¹Î±ÎºÎ¿Ï€ÏÎ½</h2>
      <div id="selectedDaysSummary"></div>
      <table id="programTable">
        <tr>
          <th>Î—Î¼Î­ÏÎ±</th>
          <th>Î ÏÏ‰Î¯/ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹</th>
          <th>Î‘Ï€ÏŒÎ³ÎµÏ…Î¼Î±/Î’ÏÎ¬Î´Ï…</th>
        </tr>
      </table>
      <button onclick="saveProgram()">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
      <div class="importExportBar">
        <button onclick="exportProgramJSON()">Î•Î¾Î±Î³Ï‰Î³Î® Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ (.json)</button>
        <input type="file" id="importProgramInput" accept=".json"/>
        <button onclick="document.getElementById('importProgramInput').click();">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚</button>
      </div>
    </section>

    <!-- ÎˆÎ¾Î¿Î´Î± -->
    <section id="exoda" class="tab-section">
      <h2>Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÏŒÏ‚ Î Î¯Î½Î±ÎºÎ±Ï‚ Î•Î¾ÏŒÎ´Ï‰Î½</h2>
      <table>
        <tr><th>ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±</th><th>Î Î¿ÏƒÏŒ (â‚¬)</th></tr>
        <tr><td>Î”Î¹ÏŒÎ´Î¹Î± (Î¼ÎµÏ„â€™ ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®Ï‚)</td><td>76,20</td></tr>
        <tr><td>Î”Î¹Î±Î¼Î¿Î½Î®</td><td>160,00</td></tr>
        <tr><td>Î¦Î±Î³Î·Ï„ÏŒ (8 Î·Î¼Î­ÏÎµÏ‚ x 60â€¯â‚¬/Î·Î¼Î­ÏÎ±)</td><td>480,00</td></tr>
        <tr><td>ÎšÎ±ÏÏƒÎ¹Î¼Î± Î‘Î¸Î®Î½Î±â€“Î ÏÎ­Î²ÎµÎ¶Î±â€“Î‘Î¸Î®Î½Î±</td><td>134,05</td></tr>
        <tr><td>ÎšÎ±ÏÏƒÎ¹Î¼Î± Î ÏÎ­Î²ÎµÎ¶Î±â€“Î£ÏÎ²Î¿Ï„Î±â€“Î ÏÎ­Î²ÎµÎ¶Î±</td><td>33,59</td></tr>
        <tr><td>ÎšÎ±ÏÏƒÎ¹Î¼Î± Î ÏÎ­Î²ÎµÎ¶Î±â€“Î Î·Î³Î­Ï‚ Î‘Ï‡Î­ÏÎ¿Î½Ï„Î±â€“Î ÏÎ­Î²ÎµÎ¶Î±</td><td>20,99</td></tr>
        <tr><td>ÎšÎ±ÏÏƒÎ¹Î¼Î± Î ÏÎ­Î²ÎµÎ¶Î± (Ï€Î±ÏÎ±Î»Î¯Î±)</td><td>5,01</td></tr>
        <tr><td>Î‘ÏÏ„Î¿Î»Î¯Î¸Î¹Î± (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)</td><td>5,39</td></tr>
        <tr><td>ÎŒÏÎ¼Î¿Ï‚ Ï„Î¿Ï… ÎŸÎ´Ï…ÏƒÏƒÎ­Î± (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)</td><td>6,16</td></tr>
        <tr><td>Î‘Î»Ï‰Î½Î¬ÎºÎ¹ (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)</td><td>7,32</td></tr>
        <tr><td>Î£ÎºÎ¬Î»Î±/Î‘Î¼Î¼Î¿Ï…Î´Î¹Î¬ (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)</td><td>12,33</td></tr>
        <tr><td>Î›Ï…Î³Î¹Î¬ (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)</td><td>8,86</td></tr>
        <tr><td><strong>Î£ÏÎ½Î¿Î»Î¿</strong></td><td><strong>949,90</strong></td></tr>
        <tr><td><strong>Î‘Ï€ÏÏŒÎ²Î»ÎµÏ€Ï„Î± Î­Î¾Î¿Î´Î± (10%)</strong></td><td><strong>94,99</strong></td></tr>
        <tr><td><strong>Î¤ÎµÎ»Î¹ÎºÏŒ ÏƒÏÎ½Î¿Î»Î¿</strong></td><td><strong>1.044,89</strong></td></tr>
      </table>
      <button onclick="exportCSV()">Î•Î¾Î±Î³Ï‰Î³Î® ÎµÎ¾ÏŒÎ´Ï‰Î½ ÏƒÎµ CSV</button>
    </section>

    <!-- Î Î±ÏÎ±Î»Î¯ÎµÏ‚ & Î¤Î± Î¼Î­ÏÎ· Î¼Î¿Ï… -->
    <section id="paralies" class="tab-section">
      

      <h3 style="margin-top:32px;">Î Î±ÏÎ±Î»Î¯ÎµÏ‚ Ï€Î¿Ï… Ï€ÏÏŒÏƒÎ¸ÎµÏƒÎµÏ‚ ÎµÏƒÏ (Ï€Î®Î³Î±Î¹Î½Î­-Î­Î»Î±)</h3>
      <table id="beachesTable">
        <tr><th>Î Î±ÏÎ±Î»Î¯Î±</th><th>Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· (Ï‡Î»Î¼, Ï€Î·Î³Î±Î¹Î½Î­-Î­Î»Î±)</th><th>ÎšÏŒÏƒÏ„Î¿Ï‚ Î²ÎµÎ½Î¶Î¯Î½Î·Ï‚ (â‚¬)</th><th>Î§Î¬ÏÏ„Î·Ï‚</th></tr>
      </table>

      <h3 style="margin-top:40px;">ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î Î±ÏÎ±Î»Î¯Î±Ï‚ (Google Places)</h3>
      <input id="beachSearchInput" class="input" type="text" placeholder="Î“ÏÎ¬ÏˆÎµ ÏŒÎ½Î¿Î¼Î± Ï€Î±ÏÎ±Î»Î¯Î±Ï‚">
      <button onclick="searchBeachGoogleAPI()">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</button>
      <ul id="beachResults" class="place-list"></ul>

      <h3 style="margin-top:40px;">ğŸ“ ÎŒÎ»Î± Ï„Î± Î¼Î­ÏÎ· Ï€Î¿Ï… ÎµÏ€Î¹ÏƒÎºÎ­Ï†Î¸Î·ÎºÎµÏ‚</h3>
      <form id="placeForm" autocomplete="off">
        <input type="text" id="placeName" class="input" placeholder="ÎŒÎ½Î¿Î¼Î± Î¼Î­ÏÎ¿Ï…Ï‚" required>
        <input type="hidden" id="placeLat">
        <input type="hidden" id="placeLon">
        <select id="placeCategory" class="input">
          <option value="beach">Î Î±ÏÎ±Î»Î¯Î± ğŸ–ï¸</option>
          <option value="sight">Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î¿ ğŸ›ï¸</option>
          <option value="food">Î¦Î±Î³Î·Ï„ÏŒ ğŸ½ï¸</option>
          <option value="other">Î†Î»Î»Î¿ ğŸ“</option>
        </select>
        <input type="date" id="visitDate" class="input">
        <textarea id="placeNotes" class="input" rows="2" placeholder="Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚"></textarea>
        <input type="file" id="placePhoto" class="input" multiple accept="image/*">
        <input type="hidden" id="placeLat">
        <input type="hidden" id="placeLon">
        <button type="submit" class="btn">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¼Î­ÏÎ¿Ï…Ï‚</button>
      </form>
      <div class="filter-bar">
        <button class="filter-btn active" onclick="setPlaceFilter('all')">ÎŒÎ»Î±</button>
        <button class="filter-btn" onclick="setPlaceFilter('beach')">Î Î±ÏÎ±Î»Î¯ÎµÏ‚ ğŸ–ï¸</button>
        <button class="filter-btn" onclick="setPlaceFilter('sight')">Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î± ğŸ›ï¸</button>
        <button class="filter-btn" onclick="setPlaceFilter('food')">Î¦Î±Î³Î·Ï„ÏŒ ğŸ½ï¸</button>
        <button class="filter-btn" onclick="setPlaceFilter('other')">Î†Î»Î»Î¿ ğŸ“</button>
      </div>
      <ul id="placeList" class="place-list"></ul>
    </section>

    <!-- Î•Ï€Î¹Ï€Î»Î­Î¿Î½ Î­Î¾Î¿Î´Î± -->
    <section id="epipleon_exoda" class="tab-section">
      <h2>â• Î•Ï€Î¹Ï€Î»Î­Î¿Î½ ÎˆÎ¾Î¿Î´Î±</h2>
      <form id="extraExpenseForm" autocomplete="off">
        <input type="text" id="extraExpenseDesc" class="input" placeholder="Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® (Ï€.Ï‡. Ï€Î±Î³Ï‰Ï„ÏŒ, Ï€Î¬ÏÎºÎ¹Î½Î³Îº)">
        <input type="number" id="extraExpenseAmount" class="input" placeholder="Î Î¿ÏƒÏŒ (â‚¬)" min="0.01" step="0.01" required>
        <button type="submit" class="btn">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ¾ÏŒÎ´Î¿Ï…</button>
      </form>
      <ul id="extraExpenseList" class="extra-expense-list"></ul>
      <div id="extraExpenseTotal" class="extra-expense-total"></div>
    </section>

    <!-- QR Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®/Î›Î®ÏˆÎ· Î ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ -->
    <section id="qrshare" class="tab-section">
      <h2>ğŸ“· QR Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®/Î›Î®ÏˆÎ· Î ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚</h2>
      <button onclick="generateQRCodeFromProgram()">ğŸ”³ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± QR Î±Ï€ÏŒ Ï„Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î¬ Î¼Î¿Ï… & Ï€Î±ÏÎ±Î»Î¯ÎµÏ‚</button>
      <div id="qrCodeContainer" style="margin:20px 0;"></div>
      <h3>Î‘Î½Î¬Î³Î½Ï‰ÏƒÎ· QR ÎºÎ±Î¹ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ & Î Î±ÏÎ±Î»Î¹ÏÎ½</h3>
      <div id="html5-qrcode" style="width:250px;margin-bottom:10px;"></div>
      <button onclick="startQRScanner()">â–¶ ÎˆÎ½Î±ÏÎ¾Î· Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚</button>
      <button onclick="stopQRScanner()">â¹ Î”Î¹Î±ÎºÎ¿Ï€Î®</button>
    </section>
<!-- Î”Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÏŒÏ‚ Î§Î¬ÏÏ„Î·Ï‚ -->
<section id="map" class="tab-section">
  <h2>ğŸ—ºï¸ Î”Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÏŒÏ‚ Î§Î¬ÏÏ„Î·Ï‚ & Î”Î¹Î±Î´ÏÎ¿Î¼Î­Ï‚</h2>
<div id="mainMap" style="width:100%;height:460px;border-radius:10px;"></div>
  <div style="margin:12px 0;">
    <select id="destinationSelect"></select>
    <button onclick="drawRoute()">â¡ï¸ Î”Î¹Î±Î´ÏÎ¿Î¼Î®</button>
    
  </div>
  
  <div id="mapPoiResults" style="margin-top:10px;color:#0099cc;font-weight:bold;"></div>
</section>

  </main>
  <script>
    // Tab ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚
    document.getElementById('tabSelect').addEventListener('change', function() {
      var val = this.value;
      document.querySelectorAll('.tab-section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(val).classList.add('active');
      if (val === 'paralies') { renderPlaces(); renderBeachesTable(); initPlacesAutocomplete(); }
      if(val === 'paralies') { renderPlaces(); renderBeachesTable(); }
      if(val === 'exoda') renderExtraExpenses();
      if(val === 'epipleon_exoda') renderExtraExpenses();
      if(val === 'programma') { renderProgramTable(); renderSelectedDaysSummary(); }
      if (val === 'map') initMapView();
    });

    const staticBeaches = ["Î‘ÏÏ„Î¿Î»Î¯Î¸Î¹Î± ğŸï¸","ÎŒÏÎ¼Î¿Ï‚ Ï„Î¿Ï… ÎŸÎ´Ï…ÏƒÏƒÎ­Î± ğŸ–ï¸","Î‘Î»Ï‰Î½Î¬ÎºÎ¹ ğŸï¸","Î£ÎºÎ¬Î»Î± (Î‘Î¼Î¼Î¿Ï…Î´Î¹Î¬) ğŸ–ï¸","Î›Ï…Î³Î¹Î¬ ğŸï¸"];
    const baseActivities = [
      "â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”","Î†Ï†Î¹Î¾Î· & Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·","ÎœÏ€Î¬Î½Î¹Î¿ ÏƒÎµ Ï€Î±ÏÎ±Î»Î¯Î±","Î•ÎºÎ´ÏÎ¿Î¼Î®",
      "Î’ÏŒÎ»Ï„Î± ÏƒÏ„Î·Î½ Î ÏÎ­Î²ÎµÎ¶Î±","Î§Î±Î»Î¬ÏÏ‰ÏƒÎ· ÏƒÏ„Î¿ camping","Î’ÏÎ±Î´Î¹Î½Î® Î­Î¾Î¿Î´Î¿Ï‚","Î•Î»ÎµÏÎ¸ÎµÏÎ¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±","Î‘Î½Î±Ï‡ÏÏÎ·ÏƒÎ·"
    ];
    const programDays = [
      { date: "12/8 (Î¤ÏÎ¯Ï„Î·)" },{ date: "13/8 (Î¤ÎµÏ„Î¬ÏÏ„Î·)" },{ date: "14/8 (Î Î­Î¼Ï€Ï„Î·)" },
      { date: "15/8 (Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®)" },{ date: "16/8 (Î£Î¬Î²Î²Î±Ï„Î¿)" },{ date: "17/8 (ÎšÏ…ÏÎ¹Î±ÎºÎ®)" },
      { date: "18/8 (Î”ÎµÏ…Ï„Î­ÏÎ±)" },{ date: "19/8 (Î¤ÏÎ¯Ï„Î·)" },{ date: "20/8 (Î¤ÎµÏ„Î¬ÏÏ„Î·)" }
    ];
    function loadPlaces() { return JSON.parse(localStorage.getItem('my_places') || "[]"); }
    function savePlaces(places) { localStorage.setItem('my_places', JSON.stringify(places)); }
    function buildActivityOptions() {
      const dynamicPlaces = loadPlaces().map(p => p.name).filter(Boolean);
      const allPlaces = Array.from(new Set(dynamicPlaces));
      return baseActivities.concat(allPlaces);
    }
    function renderProgramTable() {
      const table = document.getElementById('programTable');
      if(!table) return;
      const saved = JSON.parse(localStorage.getItem('my_program') || "[]");
      const optionsList = buildActivityOptions();
      table.innerHTML = `
        <tr>
          <th>Î—Î¼Î­ÏÎ±</th>
          <th>Î ÏÏ‰Î¯/ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹</th>
          <th>Î‘Ï€ÏŒÎ³ÎµÏ…Î¼Î±/Î’ÏÎ¬Î´Ï…</th>
        </tr>
      `;
      programDays.forEach((row, idx) => {
        let prwino = saved[idx]?.prwino || "";
        let apo = saved[idx]?.apo || "";
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.date}</td>
          <td>
            <select onchange="changeActivity(${idx},'prwino',this.value)">
              ${optionsList.map(opt =>
                `<option value="${opt}" ${opt===prwino ? "selected" : ""}>${opt}</option>`
              ).join("")}
            </select>
          </td>
          <td>
            <select onchange="changeActivity(${idx},'apo',this.value)">
              ${optionsList.map(opt =>
                `<option value="${opt}" ${opt===apo ? "selected" : ""}>${opt}</option>`
              ).join("")}
            </select>
          </td>
        `;
        table.appendChild(tr);
      });
      renderSelectedDaysSummary();
    }
    function changeActivity(idx, field, value) {
      let saved = JSON.parse(localStorage.getItem('my_program') || "[]");
      if (!saved[idx]) saved[idx] = {};
      saved[idx][field] = value;
      localStorage.setItem('my_program', JSON.stringify(saved));
      renderProgramTable();
    }
    function saveProgram() { alert('Î¤Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!'); }
    function renderSelectedDaysSummary() {
      const tableDiv = document.getElementById('selectedDaysSummary');
      const program = JSON.parse(localStorage.getItem('my_program') || "[]");
      const filled = program
        .map((v,i) => ({...v, idx: i}))
        .filter(row =>
          row &&
          (
            (row.prwino && row.prwino !== "â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”") ||
            (row.apo && row.apo !== "â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”")
          )
        );
      if (!filled.length) {
        tableDiv.innerHTML = "";
        return;
      }
      let html = `<table><tr><th>Î—Î¼Î­ÏÎ±</th><th>Î ÏÏ‰Î¯/ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹</th><th>Î‘Ï€ÏŒÎ³ÎµÏ…Î¼Î±/Î’ÏÎ¬Î´Ï…</th></tr>`;
      filled.forEach(row => {
        html += `<tr>
          <td>${programDays[row.idx].date}</td>
          <td>${row.prwino || ""}</td>
          <td>${row.apo || ""}</td>
        </tr>`;
      });
      html += `</table>
      <div style="margin-bottom:16px;color:#09a;font-size:0.98em;">Î•Î¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ Î¿Î¹ Î¼Î­ÏÎµÏ‚ Î¼Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î¼Î¯Î± ÎµÏ€Î¹Î»Î¿Î³Î®.</div>`;
      tableDiv.innerHTML = html;
    }

    // ÎˆÎ¾Î¿Î´Î± CSV
    function exportCSV() {
      const rows = [
        ["ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±","Î Î¿ÏƒÏŒ (â‚¬)"],
        ["Î”Î¹ÏŒÎ´Î¹Î± (Î¼ÎµÏ„â€™ ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®Ï‚)","76,20"],
        ["Î”Î¹Î±Î¼Î¿Î½Î®","160,00"],
        ["Î¦Î±Î³Î·Ï„ÏŒ (8 Î·Î¼Î­ÏÎµÏ‚ x 60â€¯â‚¬/Î·Î¼Î­ÏÎ±)","480,00"],
        ["ÎšÎ±ÏÏƒÎ¹Î¼Î± Î‘Î¸Î®Î½Î±â€“Î ÏÎ­Î²ÎµÎ¶Î±â€“Î‘Î¸Î®Î½Î±","134,05"],
        ["ÎšÎ±ÏÏƒÎ¹Î¼Î± Î ÏÎ­Î²ÎµÎ¶Î±â€“Î£ÏÎ²Î¿Ï„Î±â€“Î ÏÎ­Î²ÎµÎ¶Î±","33,59"],
        ["ÎšÎ±ÏÏƒÎ¹Î¼Î± Î ÏÎ­Î²ÎµÎ¶Î±â€“Î Î·Î³Î­Ï‚ Î‘Ï‡Î­ÏÎ¿Î½Ï„Î±â€“Î ÏÎ­Î²ÎµÎ¶Î±","20,99"],
        ["ÎšÎ±ÏÏƒÎ¹Î¼Î± Î ÏÎ­Î²ÎµÎ¶Î± (Ï€Î±ÏÎ±Î»Î¯Î±)","5,01"],
        ["Î‘ÏÏ„Î¿Î»Î¯Î¸Î¹Î± (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)","5,39"],
        ["ÎŒÏÎ¼Î¿Ï‚ Ï„Î¿Ï… ÎŸÎ´Ï…ÏƒÏƒÎ­Î± (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)","6,16"],
        ["Î‘Î»Ï‰Î½Î¬ÎºÎ¹ (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)","7,32"],
        ["Î£ÎºÎ¬Î»Î±/Î‘Î¼Î¼Î¿Ï…Î´Î¹Î¬ (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)","12,33"],
        ["Î›Ï…Î³Î¹Î¬ (ÎºÎ±ÏÏƒÎ¹Î¼Î±, Ï€Î®Î³Î±Î¹Î½Îµ-Î­Î»Î±)","8,86"],
        ["Î£ÏÎ½Î¿Î»Î¿","949,90"],
        ["Î‘Ï€ÏÏŒÎ²Î»ÎµÏ€Ï„Î± Î­Î¾Î¿Î´Î± (10%)","94,99"],
        ["Î¤ÎµÎ»Î¹ÎºÏŒ ÏƒÏÎ½Î¿Î»Î¿","1.044,89"]
      ];
      let csv = rows.map(r => r.map(x => `"${x}"`).join(',')).join('\n');
      let blob = new Blob([csv], {type: 'text/csv'});
      let a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'exoda.csv';
      a.click();
    }
    let placeFilter = 'all', editIdx = null;
    function renderBeachesTable() {
      const places = loadPlaces();
      const beaches = places.filter(p => p.category === 'beach');
      const table = document.getElementById('beachesTable');
      if (!table) return;
      table.innerHTML = `<tr><th>Î Î±ÏÎ±Î»Î¯Î±</th><th>Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· (Ï‡Î»Î¼, Ï€Î·Î³Î±Î¹Î½Î­-Î­Î»Î±)</th><th>ÎšÏŒÏƒÏ„Î¿Ï‚ Î²ÎµÎ½Î¶Î¯Î½Î·Ï‚ (â‚¬)</th><th>Î§Î¬ÏÏ„Î·Ï‚</th></tr>`;
      beaches.forEach(beach => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${beach.name || ''}</td>
          <td>${beach.distance || ''}</td>
          <td>${beach.cost || ''}</td>
          <td>${(beach.lat && beach.lon) ? `<a class="map-btn" href="https://www.google.com/maps?q=${beach.lat},${beach.lon}&z=15" target="_blank">Î§Î¬ÏÏ„Î·Ï‚</a>` : ''}</td>
        `;
        table.appendChild(tr);
      });
    }
    function setPlaceFilter(val) {
      placeFilter = val;
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.textContent.includes(val.charAt(0).toUpperCase() + val.slice(1)) || (val === 'all' && btn.textContent === 'ÎŒÎ»Î±')) btn.classList.add('active');
        if (val === 'beach' && btn.textContent.includes('Î Î±ÏÎ±Î»Î¯ÎµÏ‚')) btn.classList.add('active');
        if (val === 'sight' && btn.textContent.includes('Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î±')) btn.classList.add('active');
        if (val === 'food' && btn.textContent.includes('Î¦Î±Î³Î·Ï„ÏŒ')) btn.classList.add('active');
        if (val === 'other' && btn.textContent.includes('Î†Î»Î»Î¿')) btn.classList.add('active');
      });
      renderPlaces();
      renderBeachesTable();
    }
    function categoryEmoji(cat) {
      if (cat === 'beach') return 'ğŸ–ï¸';
      if (cat === 'sight') return 'ğŸ›ï¸';
      if (cat === 'food') return 'ğŸ½ï¸';
      return 'ğŸ“';
    }
    function renderPlaces() {
      const list = document.getElementById('placeList');
      if (!list) return;
      list.innerHTML = '';
      const places = loadPlaces();
      let filtered = places;
      if (placeFilter !== 'all') filtered = places.filter(p => p.category === placeFilter);
      filtered.forEach((place, idx) => {
        const li = document.createElement('li');
        li.className = 'place-item';
        if (editIdx === idx) {
          li.innerHTML = `
            <form class="edit-form" onsubmit="event.preventDefault(); saveEditPlace(${idx})">
              <input class="input" type="text" id="editPlaceName" value="${place.name || ''}" required>
              <select class="input" id="editPlaceCategory">
                <option value="beach" ${place.category === 'beach' ? 'selected' : ''}>Î Î±ÏÎ±Î»Î¯Î± ğŸ–ï¸</option>
                <option value="sight" ${place.category === 'sight' ? 'selected' : ''}>Î‘Î¾Î¹Î¿Î¸Î­Î±Ï„Î¿ ğŸ›ï¸</option>
                <option value="food" ${place.category === 'food' ? 'selected' : ''}>Î¦Î±Î³Î·Ï„ÏŒ ğŸ½ï¸</option>
                <option value="other" ${place.category === 'other' ? 'selected' : ''}>Î†Î»Î»Î¿ ğŸ“</option>
              </select>
              <input class="input" type="date" id="editVisitDate" value="${place.date || ''}">
              <textarea class="input" id="editPlaceNotes" rows="2">${place.notes || ''}</textarea>
              <input class="input" type="file" id="editPlacePhoto" accept="image/*" multiple>
              <button class="btn" type="submit">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
              <button class="btn danger" type="button" onclick="cancelEditPlace()">Î†ÎºÏ…ÏÎ¿</button>
            </form>`;
        } else {
          li.innerHTML = `
            <div class="place-title">${categoryEmoji(place.category)} ${place.name ? place.name : ''} ${place.date ? `<span style="font-size:0.9em;color:#888;">(${place.date})</span>` : ''}</div>
            <div style="margin-bottom:4px;">${place.notes ? place.notes : ''}</div>
            <div>
              ${place.distance ? `<span>Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ·: <b>${place.distance} Ï‡Î»Î¼</b></span> &nbsp;` : ''}
              ${place.cost ? `<span>ÎšÏŒÏƒÏ„Î¿Ï‚ Î²ÎµÎ½Î¶Î¯Î½Î·Ï‚: <b>${place.cost} â‚¬</b></span> &nbsp;` : ''}
              ${(place.lat && place.lon) ? `<a href="https://www.google.com/maps?q=${place.lat},${place.lon}&z=15" target="_blank" style="margin-left:10px;">Î§Î¬ÏÏ„Î·Ï‚</a>` : ''}
            </div>
            <div class="gallery">${place.photos && place.photos.length ? place.photos.map(src => `<img src="${src}" alt="photo">`).join('') : ''}</div>
            <div class="place-actions">
              <button class="action-btn" title="Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±" onclick="editPlace(${idx})">âœï¸</button>
              <button class="action-btn" title="Î”Î¹Î±Î³ÏÎ±Ï†Î®" onclick="deletePlace(${idx})">ğŸ—‘ï¸</button>
            </div>
          `;
        }
        list.appendChild(li);
      });
    }
    function editPlace(idx) {
      editIdx = idx;
      renderPlaces();
    }
    function cancelEditPlace() {
      editIdx = null;
      renderPlaces();
    }
    function saveEditPlace(idx) {
      const places = loadPlaces();
      places[idx].name = document.getElementById('editPlaceName').value.trim();
      places[idx].category = document.getElementById('editPlaceCategory').value;
      places[idx].date = document.getElementById('editVisitDate').value;
      places[idx].notes = document.getElementById('editPlaceNotes').value.trim();
      const files = document.getElementById('editPlacePhoto').files;
      if (files.length) {
        let loaded = 0;
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function (e) {
              places[idx].photos = places[idx].photos || [];
              places[idx].photos.push(e.target.result);
              loaded++;
              if(loaded === files.length) {
                savePlaces(places);
                editIdx = null;
                renderPlaces();
                renderBeachesTable();
              }
            };
            reader.readAsDataURL(file);
          }
        }
        return;
      }
      savePlaces(places);
      editIdx = null;
      renderPlaces();
      renderBeachesTable();
    }
    function deletePlace(idx) {
      const places = loadPlaces();
      places.splice(idx, 1);
      savePlaces(places);
      renderPlaces();
      renderBeachesTable();
    }
    document.getElementById('placeForm').onsubmit = async function (e) {
      e.preventDefault();
      const name = document.getElementById('placeName').value.trim();
      const category = document.getElementById('placeCategory').value;
      const date = document.getElementById('visitDate').value;
      const notes = document.getElementById('placeNotes').value.trim();
      const files = document.getElementById('placePhoto').files;
      const photos = [];
      let lat = document.getElementById('placeLat').value || undefined;
      let lon = document.getElementById('placeLon').value || undefined;
      if (files.length) {
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          if (file.type.startsWith('image/')) {
            const dataUrl = await new Promise(res => {
              const reader = new FileReader();
              reader.onload = e => res(e.target.result);
              reader.readAsDataURL(file);
            });
            photos.push(dataUrl);
          }
        }
      }
      let entry = { name, category, date, notes, photos };
      if (category === 'beach' && lat && lon) {
        const campingLat = 39.03429886578638, campingLon = 20.71407961748482;
        const beachLat = parseFloat(lat), beachLon = parseFloat(lon);
        const consumption = 7, fuelPrice = 1.75;
        const distanceOneWay = haversine(campingLat, campingLon, beachLat, beachLon);
        const distance = (distanceOneWay * 2).toFixed(1);
        const cost = ((distance / 100) * consumption * fuelPrice).toFixed(2);
        entry.lat = beachLat;
        entry.lon = beachLon;
        entry.distance = distance;
        entry.cost = cost;
      }
      const places = loadPlaces();
      places.unshift(entry);
      savePlaces(places);
      this.reset();
      document.getElementById('placeLat').value = '';
      document.getElementById('placeLon').value = '';
      renderPlaces();
      renderBeachesTable();
      renderProgramTable();
    };
    function haversine(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const toRad = deg => deg * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat / 2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }
    // Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï€Î±ÏÎ±Î»Î¯Î±Ï‚ (Open Meteo)
   
    function addBeachToPlaces(loc) {
      const campingLat = 39.03429886578638, campingLon = 20.71407961748482;
      const beachLat = parseFloat(loc.lat), beachLon = parseFloat(loc.lon);
      const distanceOneWay = haversine(campingLat, campingLon, beachLat, beachLon);
      const distance = (distanceOneWay * 2).toFixed(1);
      const consumption = 7, fuelPrice = 1.75;
      const cost = ((distance / 100) * consumption * fuelPrice).toFixed(2);
      const places = loadPlaces();
      if (places.some(p => p.name === loc.display_name && p.lat == beachLat && p.lon == beachLon)) {
        alert("Î¤Î¿ Î¼Î­ÏÎ¿Ï‚ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· ÏƒÏ„Î· Î»Î¯ÏƒÏ„Î±!");
        return;
      }
      places.unshift({
        name: loc.display_name,
        category: 'beach',
        date: '', notes: '',
        distance, cost, lat: beachLat, lon: beachLon, photos: []
      });
      savePlaces(places);
      alert("Î¤Î¿ Î¼Î­ÏÎ¿Ï‚ Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÏƒÏ„Î± 'ÎœÎ­ÏÎ· Î¼Î¿Ï…'!");
      renderPlaces();
      renderBeachesTable();
      renderProgramTable();
    }
    // Î•Ï€Î¹Ï€Î»Î­Î¿Î½ Î­Î¾Î¿Î´Î±
    function saveExtraExpenses(list) {
      localStorage.setItem('my_extra_expenses', JSON.stringify(list));
    }
    function loadExtraExpenses() {
      return JSON.parse(localStorage.getItem('my_extra_expenses') || "[]");
    }
    function renderExtraExpenses() {
      const listEl = document.getElementById('extraExpenseList');
      if(!listEl) return;
      listEl.innerHTML = '';
      const list = loadExtraExpenses();
      let total = 0;
      list.forEach((item, idx) => {
        total += Number(item.amount) || 0;
        const li = document.createElement('li');
        li.className = 'extra-expense-item';
        li.innerHTML = `
          <span>${item.desc ? item.desc : 'â€”'}</span>
          <span style="margin-left:auto;">${Number(item.amount).toFixed(2)} â‚¬</span>
          <button class="btn danger" onclick="deleteExtraExpense(${idx})">âœ—</button>
        `;
        listEl.appendChild(li);
      });
      document.getElementById('extraExpenseTotal').textContent = "Î£ÏÎ½Î¿Î»Î¿ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÎµÎ¾ÏŒÎ´Ï‰Î½: " + total.toFixed(2) + " â‚¬";
    }
    function deleteExtraExpense(idx) {
      const list = loadExtraExpenses();
      list.splice(idx, 1);
      saveExtraExpenses(list);
      renderExtraExpenses();
    }
    document.getElementById('extraExpenseForm').onsubmit = function (e) {
      e.preventDefault();
      const desc = document.getElementById('extraExpenseDesc').value.trim();
      const amount = document.getElementById('extraExpenseAmount').value;
      if (!amount || isNaN(amount) || Number(amount) <= 0) return;
      const list = loadExtraExpenses();
      list.unshift({ desc, amount });
      saveExtraExpenses(list);
      this.reset();
      renderExtraExpenses();
    };

    // === QR CODE: Î•ÎÎ‘Î“Î©Î“Î— ÎºÎ±Î¹ Î‘ÎÎ‘Î“ÎÎ©Î£Î— Î¼Îµ Î£Î¥Î“Î§Î©ÎÎ•Î¥Î£Î— Î Î¡ÎŸÎ“Î¡Î‘ÎœÎœÎ‘ Î‘Î›Î›Î‘ ÎºÎ±Î¹ ÎœÎ•Î¡Î— (Ï‡Ï‰ÏÎ¯Ï‚ photos) ===

    // Remove the "photos" property from each place
    function stripPhotos(places) {
      return places.map(p => {
        const {photos, ...rest} = p;
        return rest;
      });
    }
    // ÎœÎ¿Î½Î±Î´Î¹ÎºÏŒÏ„Î·Ï„Î± Î³Î¹Î± ÏƒÏ…Î³Ï‡ÏÎ½ÎµÏ…ÏƒÎ·: Î²Î¬ÏƒÎµÎ¹ Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚ ÎºÎ±Î¹ ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½Ï‰Î½ (Î¼Î¹ÎºÏÎ® Î±Ï…ÏƒÏ„Î·ÏÏŒÏ„Î·Ï„Î±)
    function isSamePlace(a, b) {
      return a.name === b.name &&
        ((a.lat && b.lat && Number(a.lat) === Number(b.lat)) || (!a.lat && !b.lat)) &&
        ((a.lon && b.lon && Number(a.lon) === Number(b.lon)) || (!a.lon && !b.lon));
    }
    function mergePlaces(oldList, newList) {
      const merged = [...oldList];
      newList.forEach(np => {
        if (!merged.some(op => isSamePlace(op, np))) {
          merged.push(np);
        }
      });
      return merged;
    }
    // === Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± QR Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹: { program: [...], places: [...] [Ï‡Ï‰ÏÎ¯Ï‚ photos] } ===
    function generateQRCodeFromProgram() {
      const program = localStorage.getItem('my_program');
      if (!program) return alert("Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏƒÎµÎ¹ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±.");
      const places = stripPhotos(loadPlaces());
      const dataObj = { program: JSON.parse(program), places };
      const jsonStr = JSON.stringify(dataObj);
      // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚
      if (jsonStr.length > 3500) {
        return alert("Î¤Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± & Î¿Î¹ Ï€Î±ÏÎ±Î»Î¯ÎµÏ‚ ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï Î¼ÎµÎ³Î¬Î»Î± Î³Î¹Î± QR code! Î‘Ï†Î±Î¯ÏÎµÏƒÎµ Î® Î±ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î± Î¼Î­ÏÎ·.");
      }
      const container = document.getElementById('qrCodeContainer');
      container.innerHTML = '';
console.log("ÎœÎ®ÎºÎ¿Ï‚ QR string:", jsonStr.length);

QRCode.toString(jsonStr, { type: 'svg', width: 440, errorCorrectionLevel: 'L', margin: 10 }, function (err, svg) {
  if (err) {
    container.innerText = "Î£Ï†Î¬Î»Î¼Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ QR!";
  } else {
    container.innerHTML = svg;
  }
});
    }
    let qrScannerInstance = null;
    function startQRScanner() {
      const qrDiv = document.getElementById('html5-qrcode');
      if (qrScannerInstance) {
        return;
      }
      qrDiv.innerHTML = "";
      qrScannerInstance = new Html5Qrcode("html5-qrcode");
      qrScannerInstance.start(
        { facingMode: "environment" },
        {
          fps: 20,
          qrbox: { width: 280, height: 280 }
        },
        qrCodeMessage => {
          try {
            const data = JSON.parse(qrCodeMessage);
            if (Array.isArray(data)) {
              // Î Î±Î»Î¹Î¬ Î¼Î¿ÏÏ†Î® (Î¼ÏŒÎ½Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±, array)
              localStorage.setItem('my_program', JSON.stringify(data));
              alert("âœ” Î¤Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ Î±Ï€ÏŒ QR!");
              if(document.querySelector('#programma').classList.contains('active')) {
                renderProgramTable();
                renderSelectedDaysSummary();
              }
            } else if (typeof data === 'object' && data.program && Array.isArray(data.program)) {
              // ÎÎ­Î± Î¼Î¿ÏÏ†Î® { program: [...], places: [...] }
              localStorage.setItem('my_program', JSON.stringify(data.program));
              // Î£Ï…Î³Ï‡ÏÎ½ÎµÏ…ÏƒÎ· places Ï‡Ï‰ÏÎ¯Ï‚ photos
              if (Array.isArray(data.places)) {
                let oldPlaces = loadPlaces();
                const newPlaces = data.places;
                const merged = mergePlaces(oldPlaces, newPlaces);
                savePlaces(merged);
                alert("âœ” Î¤Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ÎºÎ±Î¹ Î¿Î¹ Ï€Î±ÏÎ±Î»Î¯ÎµÏ‚/Î¼Î­ÏÎ· ÏƒÏ…Î³Ï‡Ï‰Î½ÎµÏÏ„Î·ÎºÎ±Î½ Î±Ï€ÏŒ QR!");
                renderPlaces();
                renderBeachesTable();
              } else {
                alert("âœ” Î¤Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Ï†Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ Î±Ï€ÏŒ QR.");
              }
              if(document.querySelector('#programma').classList.contains('active')) {
                renderProgramTable();
                renderSelectedDaysSummary();
              }
              if(document.querySelector('#paralies').classList.contains('active')) {
                renderPlaces();
                renderBeachesTable();
              }
            } else {
              alert("Î¤Î¿ QR Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î¼Î· Î­Î³ÎºÏ…ÏÎ± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±.");
            }
          } catch {
            alert("Î¤Î¿ QR Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿ Î® Î´ÎµÎ½ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ JSON Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±!");
          }
        },
        errorMessage => {}
      ).catch(err => {
        alert("Î”ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¬Î¼ÎµÏÎ± Î® Ï„Î¿ QR scanner.\n\n" + err);
      });
    }
    function stopQRScanner() {
      if (qrScannerInstance) {
        qrScannerInstance.stop().then(() => {
          document.getElementById('html5-qrcode').innerHTML = "";
          qrScannerInstance = null;
        });
      }
    }
    // Î•Î¾Î±Î³Ï‰Î³Î®/ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ JSON (ÏŒÏ€Ï‰Ï‚ Î®Ï„Î±Î½)
    function exportProgramJSON() {
      const data = localStorage.getItem('my_program');
      if (!data) return alert("Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏƒÎµÎ¹ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±.");
      const blob = new Blob([data], {type: 'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'program.json';
      a.click();
    }
    document.getElementById('importProgramInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        try {
          const parsed = JSON.parse(ev.target.result);
          if (Array.isArray(parsed)) {
            localStorage.setItem('my_program', JSON.stringify(parsed));
            alert("âœ” Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Ï†Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ (Î¼ÏŒÎ½Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±)!");
            renderProgramTable();
            renderSelectedDaysSummary();
          } else if (typeof parsed === 'object' && parsed.program && Array.isArray(parsed.program)) {
            localStorage.setItem('my_program', JSON.stringify(parsed.program));
            // ÏƒÏ…Î³Ï‡ÏÎ½ÎµÏ…ÏƒÎ· places
            if (Array.isArray(parsed.places)) {
              let oldPlaces = loadPlaces();
              const newPlaces = parsed.places;
              const merged = mergePlaces(oldPlaces, newPlaces);
              savePlaces(merged);
              renderPlaces();
              renderBeachesTable();
              alert("Î¦Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎ±Î½ Î½Î­Î± Î¼Î­ÏÎ· Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Î´Î¹Î±Î³ÏÎ±Ï†Î¿ÏÎ½ Ï„Î± Ï€Î±Î»Î¹Î¬!");
            } else {
              alert("Î¦Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ Î¼ÏŒÎ½Î¿ Ï„Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±.");
            }
            renderProgramTable();
            renderSelectedDaysSummary();
          } else {
            alert("Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±.");
          }
        } catch {
          alert("Î£Ï†Î¬Î»Î¼Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï…. Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿ JSON.");
        }
      };
      reader.readAsText(file);
    });

    // Î•ÎºÎºÎ¯Î½Î·ÏƒÎ· ÏŒÎ»Ï‰Î½ ÏŒÏ„Î±Î½ Î±Î½Î¿Î¯Î³ÎµÎ¹ Î· ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± Ï„Î¿ default tab
    renderProgramTable();
    renderSelectedDaysSummary();
    renderPlaces();
    renderBeachesTable();
    renderExtraExpenses();
function searchBeachGoogleAPI() {
  const input = document.getElementById('beachSearchInput');
  const resultsList = document.getElementById('beachResults');
  const query = input.value.trim();

  if (!query) {
    resultsList.innerHTML = '';
    return;
  }

  resultsList.innerHTML = '<li>Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÏƒÏ„Î·Î½ Google Maps...</li>';

  const service = new google.maps.places.PlacesService(document.getElementById("mainMap"));
 
  const request = {
    query: query,
    fields: ['name', 'geometry', 'formatted_address'],
    locationBias: { radius: 50000, center: { lat: 39.034, lng: 20.714 } }
  };

  service.findPlaceFromQuery(request, (results, status) => {
    if (status !== google.maps.places.PlacesServiceStatus.OK || !results.length) {
      resultsList.innerHTML = '<li>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± ÏƒÏ„Î·Î½ Google.</li>';
      return;
    }

    resultsList.innerHTML = results.map(place => {
      const name = place.name;
      const lat = place.geometry.location.lat();
      const lon = place.geometry.location.lng();
      const address = place.formatted_address || "";

      return `
        <li class="place-item">
          <div>ğŸ–ï¸ <b>${name}</b><br><span style="color:#666;">${address}</span></div>
          <div><b>${lat.toFixed(6)}, ${lon.toFixed(6)}</b></div>
          <button onclick="window.open('https://www.google.com/maps?q=${lat},${lon}&z=15','_blank')">Î§Î¬ÏÏ„Î·Ï‚</button>
          <button style="background:#20b46a;color:#fff;" onclick='addBeachToPlaces({
            "display_name": "${name}",
            "lat": ${lat},
            "lon": ${lon}
          })'>Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
        </li>`;
    }).join('');
  });
}
let map, directionsService, directionsRenderer;
let camping = { lat: 39.03429886578638, lng: 20.71407961748482 };
let snappedRoutePath = [], allMarkers = [], routePoiMarkers = [];

function initMapView() {
  if (map) {
    drawPlaceMarkers();             // âœ… Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ markers Î¼Îµ Ï„Î± Î½Î­Î± Î¼Î­ÏÎ·
    populateDestinationSelect();    // âœ… Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· dropdown ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚ Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚
    return;
  }

  map = new google.maps.Map(document.getElementById("mainMap"), {
    zoom: 11,
    center: { lat: 39.03429886578638, lng: 20.71407961748482 }
  });

  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({ map, suppressMarkers: true });

  new google.maps.Marker({
    position: { lat: 39.03429886578638, lng: 20.71407961748482 },
    map: map,
    title: "Camping (ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·)",
    icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
  });

  drawPlaceMarkers();
  populateDestinationSelect();

}

function loadPlaces() {
  return JSON.parse(localStorage.getItem('my_places') || "[]");
}

function drawPlaceMarkers() {
  allMarkers.forEach(m => m.setMap(null));
  allMarkers = [];

  loadPlaces().forEach((p, i) => {
    if (p.lat && p.lon) {
      const marker = new google.maps.Marker({
        position: { lat: Number(p.lat), lng: Number(p.lon) },
        map,
        icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
        title: p.name
      });
      const iw = new google.maps.InfoWindow({
        content: `<strong>${p.name}</strong><br>${p.category || ''}<br><button onclick="goToPlace(${i})">Î”Î¹Î±Î´ÏÎ¿Î¼Î®</button>`
      });
      marker.addListener("click", () => iw.open(map, marker));
      allMarkers.push(marker);
    }
  });
}

function populateDestinationSelect() {
  const sel = document.getElementById("destinationSelect");
  sel.innerHTML = "<option value=''>â€” Î•Ï€Î¹Î»Î¿Î³Î® Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿Ï â€”</option>";
  loadPlaces().forEach((p, i) => {
    if (p.lat && p.lon)
      sel.innerHTML += `<option value="${i}">${p.name}</option>`;
  });
}

function goToPlace(i) {
  document.getElementById("destinationSelect").value = i;
  drawRoute();
}

function drawRoute() {
  const idx = document.getElementById("destinationSelect").value;
  const p = loadPlaces()[idx];
  if (!p || !p.lat || !p.lon) return;

  const dest = { lat: Number(p.lat), lng: Number(p.lon) };
  directionsService.route({
    origin: camping,
    destination: dest,
    travelMode: 'DRIVING'
  }, (res, status) => {
    if (status === 'OK') {
      directionsRenderer.setDirections(res);
      snappedRoutePath = res.routes[0].overview_path;
      clearPOIMarkers();
    }
  });
}

function searchAlongRoute() {
  if (!snappedRoutePath.length) return alert("Î•Î¼Ï†Î¬Î½Î¹ÏƒÎµ Ï€ÏÏÏ„Î± Î´Î¹Î±Î´ÏÎ¿Î¼Î®.");
  const poiType = document.getElementById("poiType").value;
  clearPOIMarkers();
  const service = new google.maps.places.PlacesService(document.getElementById("mainMap"));
  const points = [];
  for (let i = 0; i < snappedRoutePath.length; i += 20)
    points.push(snappedRoutePath[i]);

  let done = 0, results = [];
  points.forEach(p => {
    service.nearbySearch({ location: p, radius: 15000, type: [poiType] }, (res, status) => {
      done++;
      if (status === 'OK') results = results.concat(res);
     if (done === points.length) {
  const seen = {};
  res = results.filter(r => {
    if (seen[r.place_id]) return false;
    seen[r.place_id] = true;
    return true;
  });

  // âœ… Î‘Î½ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½, Î²Î³Î¬Î¶ÎµÎ¹ Î¼Î®Î½Ï…Î¼Î± ÎºÎ±Î¹ ÏƒÏ„Î±Î¼Î±Ï„Î¬
  if (!res.length) {
    document.getElementById("mapPoiResults").innerText = "âš ï¸ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±.";
    return;
  }

 res.forEach(place => {
  try {
    // Î•Ï€Î¯Ï€ÎµÎ´Î¿ Ï†Î¯Î»Ï„ÏÎ¿: ÎœÏŒÎ½Î¿ POI Î¼Îµ Î­Î³ÎºÏ…ÏÎ· Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±!
    if (!place.geometry || !place.geometry.location) return;

    const m = new google.maps.Marker({
      map,
      position: place.geometry.location,
      icon: "http://maps.google.com/mapfiles/ms/icons/green-dot.png",
      title: place.name
    });
    const iw = new google.maps.InfoWindow({
      content: `<b>${place.name}</b><br>${place.vicinity || ''}`
    });
    m.addListener("click", () => iw.open(map, m));
    routePoiMarkers.push(m);
  } catch (e) {
    // Î‘Î³Î½ÏŒÎ·ÏƒÎµ Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ POI Î±Î½ Î­Ï‡ÎµÎ¹ ÏƒÏ†Î¬Î»Î¼Î±, ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï‡Î±Î»Î¬ÎµÎ¹ Î¿ Ï‡Î¬ÏÏ„Î·Ï‚!
    console.warn("Î£Ï†Î¬Î»Î¼Î± ÏƒÎµ POI marker:", e);
  }
});



  document.getElementById("mapPoiResults").innerText = `ğŸ” Î’ÏÎ­Î¸Î·ÎºÎ±Î½ ${res.length} ÏƒÎ·Î¼ÎµÎ¯Î± along route.`;
}

    });
  });
}

function clearPOIMarkers() {
  routePoiMarkers.forEach(m => m.setMap(null));
  routePoiMarkers = [];
  document.getElementById("mapPoiResults").innerText = '';
}

// === Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· Google Places Autocomplete ÏƒÏ„Î· Ï†ÏŒÏÎ¼Î± Î½Î­Î¿Ï… Î¼Î­ÏÎ¿Ï…Ï‚ ===
let autocompleteInstance = null;

function initPlacesAutocomplete() {
  const input = document.getElementById('placeName');
  if (!input || typeof google === "undefined" || !google.maps || !google.maps.places) return;

  // Î‘Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·, Î¼Î·Î½ Ï„Î¿ Î´ÎµÏƒÎ¼ÎµÏÏƒÎµÎ¹Ï‚ Î´ÎµÏÏ„ÎµÏÎ· Ï†Î¿ÏÎ¬
  if (autocompleteInstance) return;

  autocompleteInstance = new google.maps.places.Autocomplete(input, {
    fields: ["name", "geometry"],
    types: ["establishment", "geocode"]
  });

  autocompleteInstance.addListener('place_changed', function() {
    const place = autocompleteInstance.getPlace();
    if (place.geometry && place.geometry.location) {
      document.getElementById('placeLat').value = place.geometry.location.lat();
      document.getElementById('placeLon').value = place.geometry.location.lng();
    }
  });
}

// Î•ÎºÎºÎ¯Î½Î·ÏƒÎ· Autocomplete ÏƒÏ„Î·Î½ Ï€ÏÏÏ„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ·
window.addEventListener('DOMContentLoaded', initPlacesAutocomplete);

  </script>
</body>
</html>
